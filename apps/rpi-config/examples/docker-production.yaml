# Generated by catalyst-rpi-config v1.0.0
# Mode: docker | Device: pi4 | WiFi: yes | Cloudflared: yes
# Re-run `catalyst-rpi-config` to regenerate, or edit this file directly.
#
# Equivalent CLI command:
#   catalyst-rpi-config \
#     --non-interactive \
#     --mode docker \
#     --device pi4 \
#     --hostname catalyst-prod-docker \
#     --username catalyst \
#     --password "secure-password" \
#     --registry "ghcr.io/your-org" \
#     --tag "v1.2.0" \
#     --wifi-ssid "CorpNetwork" \
#     --wifi-password "corp-wifi-pass" \
#     --wifi-country US \
#     --ssh-pubkey-file ~/.ssh/deploy_key.pub \
#     --node-id "prod-docker-001" \
#     --peering-secret "production-peering-secret" \
#     --domains "example.com,api.example.com" \
#     --port 3000 \
#     --bootstrap-token "initial-bootstrap-token" \
#     --log-level info \
#     --cloudflared-token "eyJhIjoiLi4uIn0=" \
#     -o dist/rpi

# Base OS: Debian 12 (Bookworm) minimal with systemd, apt, SSH
include:
  file: bookworm-minbase.yaml

# Target device and login credentials
device:
  layer: pi4 # Hardware: Raspberry Pi 4
  hostname: catalyst-prod-docker
  user1: catalyst # Login username
  user1pass: secure-password # Login password (change after first boot)

# Disk image layout
image:
  layer: image-rpios # Standard MBR boot + root partition
  boot_part_size: '200%'
  root_part_size: '500%'
  name: catalyst-node-image

# Docker: add the build user to the docker group
docker:
  trust_user1: 'y'

# Layers to include in the build.
# Each entry pulls in a layer YAML and its transitive dependencies.
# Remove a line to exclude that feature from the image.
layer:
  container: docker-debian-bookworm # Docker CE engine (built-in layer)
  app: catalyst-docker-stack # Catalyst Node composite server
  wifi: catalyst-wifi # WiFi (wpa_supplicant + systemd-networkd)
  tunnel: catalyst-cloudflared # Cloudflare Tunnel for remote SSH

# WiFi network configuration.
# Credentials are written to /etc/wpa_supplicant/wpa_supplicant-wlan0.conf
wifi:
  ssid: CorpNetwork
  password: corp-wifi-pass
  country: US # ISO 3166-1 alpha-2 regulatory code

# SSH: public key authentication only (password auth disabled)
ssh:
  pubkey_only: 'y'
  pubkey_user1: ssh-ed25519 AAAAC3NzaC1lZDI1NTE5AAAAI...your-key... deploy@host

# Cloudflare Tunnel for remote SSH access.
# Token from: Cloudflare Zero Trust dashboard > Networks > Tunnels
cloudflared:
  tunnel_token: eyJhIjoiLi4uIn0=

# Catalyst Node settings. See: catalyst-node --help for all options
catalyst:
  registry: ghcr.io/your-org # Docker registry for catalyst images
  tag: v1.2.0 # Container image tag
  node_id: prod-docker-001 # Unique identifier (auto-generated on first boot if empty)
  peering_secret: production-peering-secret # iBGP peering shared secret
  domains: example.com,api.example.com # Comma-separated trusted domains
  port: '3000' # Composite server listen port
  bootstrap_token: initial-bootstrap-token # Initial auth bootstrap token
  log_level: info # debug, info, warn, error
