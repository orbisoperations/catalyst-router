name: IBGP Resource Policy Test

principals:
  # Can connect, update, and delete peers
  admin:
    id: admin_user
    roles: ['admin']

  peer:
    id: peer_resource_01
    roles: ['peer']

  # Cannot connect, update, and delete peers
  data_custodian:
    id: data_custodian_user
    roles: ['data_custodian']

  network_operator:
    id: network_operator_user
    roles: ['network_operator']

  peer_custodian:
    id: peer_custodian_user
    roles: ['peer_custodian']

  user:
    id: user_user
    roles: ['user']

resources:
  ibgp_resource:
    kind: ibgp
    id: ibgp_resource_01

  peer_resource:
    kind: peer
    id: peer_01

tests:
  - name: Only Admin and Peer can connect, update, and delete peers
    input:
      principals: ['admin', 'peer']
      resources: ['ibgp_resource']
      actions: ['open', 'close', 'update']
    expected:
      - principal: admin
        resource: ibgp_resource
        actions:
          open: EFFECT_ALLOW
          update: EFFECT_ALLOW
          close: EFFECT_ALLOW
      - principal: peer
        resource: ibgp_resource
        actions:
          open: EFFECT_ALLOW
          update: EFFECT_ALLOW
          close: EFFECT_ALLOW

  - name: Rest of the principals cannot connect, update, and delete peers
    input:
      principals: ['data_custodian', 'network_operator', 'peer_custodian', 'user']
      resources: ['ibgp_resource']
      actions: ['open', 'close', 'update']
    expected:
      - principal: data_custodian
        resource: ibgp_resource
        actions:
          open: EFFECT_DENY
          update: EFFECT_DENY
          close: EFFECT_DENY
      - principal: network_operator
        resource: ibgp_resource
        actions:
          open: EFFECT_DENY
          update: EFFECT_DENY
          close: EFFECT_DENY
      - principal: peer_custodian
        resource: ibgp_resource
        actions:
          open: EFFECT_DENY
          update: EFFECT_DENY
          close: EFFECT_DENY
      - principal: user
        resource: ibgp_resource
        actions:
          open: EFFECT_DENY
          update: EFFECT_DENY
          close: EFFECT_DENY
